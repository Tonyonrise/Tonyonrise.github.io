
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…¨çƒé¡¶å°–å¤§å­¦(Top 500)åˆ†å¸ƒå¯è§†åŒ–</title>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    
    /* æ ‡é¢˜è¦†ç›–å±‚ */
    #title-card {
      position: absolute;
      top: 20px;
      left: 20px;
      color: width;
      z-index: 1;
      pointer-events: none; /* è®©é¼ æ ‡äº‹ä»¶ç©¿é€åˆ°åœ°çƒ */
    }
    
    h1 {
      color: #fff;
      margin: 0;
      font-size: 24px;
      text-shadow: 0 0 10px rgba(0,0,0,0.8);
    }
    
    p {
      color: #ccc;
      margin-top: 5px;
      font-size: 14px;
    }

    /* å›¾ä¾‹ */
    .legend {
      position: absolute;
      bottom: 30px;
      right: 30px;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
      backdrop-filter: blur(5px);
      color: white;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .gradient-bar {
      width: 150px;
      height: 10px;
      background: linear-gradient(90deg, #2c3e50, #26619c, #e67e22, #c0392b);
      border-radius: 5px;
    }
    .legend-labels {
      display: flex;
      justify-content: space-between;
    }
  </style>

  <!-- å¼•å…¥å¿…è¦çš„åº“ -->
  <script src="//unpkg.com/d3"></script>
  <script src="//unpkg.com/globe.gl"></script>
</head>
<body>

  <div id="title-card">
    <h1>ğŸŒ å…¨çƒé¡¶å°–å¤§å­¦åˆ†å¸ƒå›¾ (Top 500)</h1>
    <p>æ•°æ®æ¥æºï¼šæ¨¡æ‹Ÿæ•°æ® (åŸºäºå¸¸è§æ’åæ¦‚ç®—) | äº¤äº’ï¼šæ‹–æ‹½æ—‹è½¬ï¼Œæ»šè½®ç¼©æ”¾ï¼Œæ‚¬åœæŸ¥çœ‹è¯¦æƒ…</p>
  </div>

  <div class="legend">
    <div>å¤§å­¦æ•°é‡çƒ­åŠ›å›¾</div>
    <div class="gradient-bar"></div>
    <div class="legend-labels">
      <span>0</span>
      <span>50+</span>
      <span>100+</span>
    </div>
  </div>

  <div id="globeViz"></div>

  <script>
    // 1. æ¨¡æ‹Ÿæ•°æ®ï¼šä¸–ç•Œå„å›½Top 500å¤§å­¦æ•°é‡ (åŸºäºQS/Timesç­‰æ’åçš„æ¦‚ç•¥æ•°æ®ç”¨äºæ¼”ç¤º)
    // é”®åå¿…é¡»ä¸ GeoJSON ä¸­çš„ ADMIN æˆ– NAME å±æ€§åŒ¹é…
    const universityData = {
      "United States of America": 130,
      "United Kingdom": 48,
      "China": 45,
      "Germany": 30,
      "Australia": 25,
      "Canada": 22,
      "Japan": 15,
      "France": 18,
      "Netherlands": 12,
      "South Korea": 10,
      "Switzerland": 9,
      "Sweden": 8,
      "Italy": 10,
      "Spain": 8,
      "Russia": 7,
      "Singapore": 6,
      "Hong Kong S.A.R.": 5, // æ³¨æ„ GeoJSON å¯èƒ½å°†é¦™æ¸¯å•ç‹¬åˆ—å‡º
      "Taiwan": 5,
      "India": 8,
      "Brazil": 4,
      "Belgium": 6,
      "Denmark": 5,
      "New Zealand": 5,
      "Austria": 4,
      "Ireland": 5,
      "Norway": 4,
      "Finland": 3,
      "Israel": 2,
      "Saudi Arabia": 3,
      "South Africa": 3,
      "Malaysia": 2,
      "Mexico": 2,
      "Chile": 1,
      "Argentina": 1,
      "Turkey": 1
    };

    // 2. è®¾ç½®é¢œè‰²æ¯”ä¾‹å°º (ä½¿ç”¨ D3.js)
    // å®šä¹‰åŸŸä» 0 åˆ° 100+ï¼Œé¢œè‰²ä»æ·±è“è¿‡æ¸¡åˆ°äº®çº¢
    const colorScale = d3.scaleLinear()
      .domain([0, 5, 20, 100])
      .range(['#2c3e50', '#26619c', '#e67e22', '#c0392b']);

    // 3. è·å–ä¸–ç•Œåœ°å›¾ GeoJSON æ•°æ®
    fetch('https://raw.githubusercontent.com/vasturiano/globe.gl/master/example/datasets/ne_110m_admin_0_countries.geojson')
      .then(res => res.json())
      .then(countries => {
        
        // åˆå§‹åŒ–åœ°çƒå®ä¾‹
        const world = Globe()
          (document.getElementById('globeViz'))
          .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg') // ä½¿ç”¨å¤œé—´åœ°çƒè´´å›¾
          .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png') // æ˜Ÿç©ºèƒŒæ™¯
          .lineHoverPrecision(0)
          
          // é…ç½®å¤šè¾¹å½¢ï¼ˆå›½å®¶æ¿å—ï¼‰
          .polygonsData(countries.features.filter(d => d.properties.ADMIN !== "Antarctica")) // è¿‡æ»¤æ‰å—ææ´²ä»¥ç¾åŒ–è§†è§‰
          .polygonAltitude(0.005) // åŸºç¡€é«˜åº¦
          .polygonCapColor(d => {
            // æ ¹æ®å¤§å­¦æ•°é‡è·å–é¢œè‰²
            const count = universityData[d.properties.ADMIN] || 0;
            // å¦‚æœæ•°é‡ä¸º0ï¼Œæ˜¾ç¤ºåŠé€æ˜ç°è‰²ï¼Œå¦åˆ™æ˜¾ç¤ºå¯¹åº”é¢œè‰²
            return count === 0 ? 'rgba(255,255,255, 0.05)' : colorScale(count);
          })
          .polygonSideColor(() => 'rgba(255, 255, 255, 0.05)')
          .polygonStrokeColor(() => '#111')
          
          // æ‚¬åœäº¤äº’é€»è¾‘
          .polygonLabel(({ properties: d }) => {
            const count = universityData[d.ADMIN] || 0;
            return `
              <div style="background: rgba(0,0,0,0.8); color: white; padding: 8px; border-radius: 4px; border: 1px solid #555;">
                <strong style="font-size: 14px;">${d.ADMIN} (${d.ISO_A3})</strong><br/>
                <span style="color: #ffd700;">Top 500 Universities: ${count}</span>
              </div>
            `;
          })
          .onPolygonHover(hoverD => {
            // å½“é¼ æ ‡æ‚¬åœæ—¶ï¼Œæ”¹å˜æ¿å—çš„é«˜åº¦å’Œé¢œè‰²
            world
              .polygonAltitude(d => d === hoverD ? 0.06 : 0.005) // æ‚¬åœçš„å›½å®¶å‡¸èµ·
              .polygonCapColor(d => {
                const count = universityData[d.properties.ADMIN] || 0;
                // æ‚¬åœæ—¶å˜äº®ï¼Œéæ‚¬åœä¿æŒåŸæ ·
                return d === hoverD ? '#5faee3' : (count === 0 ? 'rgba(255,255,255, 0.05)' : colorScale(count));
              });
          })
          
          // åˆå§‹é…ç½®
          .pointOfView({ lat: 20, lng: 0, altitude: 2.5 }); // åˆå§‹è§†è§’

        // 4. è‡ªåŠ¨æ—‹è½¬æ§åˆ¶
        world.controls().autoRotate = true;
        world.controls().autoRotateSpeed = 0.5;

        // å½“ç”¨æˆ·æ“ä½œæ—¶ï¼Œæš‚åœè‡ªåŠ¨æ—‹è½¬ä¸€å°ä¼šå„¿
        const globeContainer = document.getElementById('globeViz');
        globeContainer.addEventListener('mousedown', () => { world.controls().autoRotate = false; });
        globeContainer.addEventListener('mouseup', () => { setTimeout(() => world.controls().autoRotate = true, 2000); });
      });

      // çª—å£å¤§å°è°ƒæ•´é€‚é…
      window.addEventListener('resize', () => {
        // Globe.gl ä¼šè‡ªåŠ¨å¤„ç† resizeï¼Œä½†åœ¨æŸäº›å¸ƒå±€ä¸‹å¯èƒ½éœ€è¦æ‰‹åŠ¨è§¦å‘åˆ·æ–°ï¼Œ
        // è¿™é‡Œç›´æ¥ä¾èµ–åº“çš„è‡ªé€‚åº”èƒ½åŠ›é€šå¸¸è¶³å¤Ÿã€‚
      });
  </script>
</body>
</html>